---
import Layout from "../layouts/Layout.astro";
import { Brain, Zap, Target, Shield } from "lucide-astro";
---

<Layout
    title="Architecture & Philosophy - dora"
    description="Why dora exists and how it's built. Learn about SCIP indexing, performance optimizations, and design principles for fast code intelligence."
>
    <div class="max-w-4xl mx-auto px-6 py-20">
        <div class="mb-12">
            <h1 class="text-5xl font-bold mb-4">Architecture & Philosophy</h1>
            <p class="text-xl text-zinc-400">
                Why <code
                    class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-lg"
                    >dora</code
                > exists and how it's built
            </p>
        </div>

        <!-- The Problem -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center"
                >
                    <Brain class="w-5 h-5 text-blue-400" />
                </div>
                The Problem
            </h2>
            <div class="prose prose-invert max-w-none">
                <p class="text-zinc-300 text-lg leading-relaxed mb-4">
                    AI coding assistants need to understand your codebase, but
                    they can't read every file, it's too slow and exceeds token
                    limits. Large codebases especially benefit from this, but
                    any project with more than a few dozen files can use better
                    code intelligence.
                </p>
                <p class="text-zinc-400 leading-relaxed">
                    Without a proper index, AI agents grep through files or try
                    to parse syntax trees. <code
                        class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-xs"
                        >dora</code
                    > gives them a queryable database of symbols, dependencies, and
                    referencesso they know what exists and where to look before reading
                    any code.
                </p>
            </div>
        </section>

        <!-- The Solution -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center"
                >
                    <Target class="w-5 h-5 text-blue-400" />
                </div>
                The Solution
            </h2>
            <div class="prose prose-invert max-w-none">
                <p class="text-zinc-300 text-lg leading-relaxed mb-4">
                    <code
                        class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-lg"
                        >dora</code
                    > builds a queryable index of your codebase using
                    <a
                        href="https://github.com/sourcegraph/scip"
                        class="underline underline-offset-2"
                        target="_blank"
                        rel="noreferrer"
                        ><strong class="text-zinc-200">SCIP</strong>
                        (SCIP Code Intelligence Protocol)</a
                    >. SCIP is a language-agnostic format for code navigation
                    data, developed at Sourcegraph.
                </p>
                <p class="text-zinc-400 leading-relaxed mb-4">
                    Instead of grepping files or parsing syntax trees, <code
                        >dora</code
                    >
                    converts SCIP indexes into an optimized SQLite database. This
                    gives AI agents instant access to:
                </p>
                <ul class="space-y-2 text-zinc-400">
                    <li class="flex items-start gap-2">
                        <span class="text-blue-400 mt-1">→</span>
                        <span>Symbol definitions and their locations</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-400 mt-1">→</span>
                        <span>File dependencies and reverse dependencies</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-400 mt-1">→</span>
                        <span>Symbol references across the entire codebase</span
                        >
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-400 mt-1">→</span>
                        <span
                            >Architectural metrics like coupling and complexity</span
                        >
                    </li>
                </ul>
            </div>
        </section>

        <!-- Design Principles -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center"
                >
                    <Zap class="w-5 h-5 text-blue-400" />
                </div>
                Design Principles
            </h2>
            <div class="space-y-6">
                <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
                    <h3 class="text-xl font-semibold mb-3 text-blue-300">
                        1. Metadata, Not Source Code
                    </h3>
                    <p class="text-zinc-400">
                        <code
                            class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-sm"
                            >dora</code
                        > stores only symbol names, locations, and relationships.
                        The actual source code stays in your files. This keeps the
                        database small and lets AI agents find what they need, then
                        read only those specific files.
                    </p>
                </div>

                <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
                    <h3 class="text-xl font-semibold mb-3 text-blue-300">
                        2. Queryable Database
                    </h3>
                    <p class="text-zinc-400">
                        Built-in commands cover common cases, but <code
                            >dora</code
                        > exposes the full SQLite database. AI agents can write custom
                        SQL queries for whatever they need. The schema is straightforward;
                        just files, symbols, and dependencies.
                    </p>
                </div>

                <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
                    <h3 class="text-xl font-semibold mb-3 text-blue-300">
                        3. JSON Output
                    </h3>
                    <p class="text-zinc-400">
                        All output is valid JSON. No pretty-printing, no colors,
                        no extra formatting. Makes it easy to pipe into other
                        tools or parse programmatically.
                    </p>
                </div>
            </div>
        </section>

        <!-- How It Works -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center"
                >
                    <Shield class="w-5 h-5 text-blue-400" />
                </div>
                How It Works
            </h2>
            <div class="space-y-4 text-zinc-400">
                <p>
                    You run <code
                        class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-sm"
                        >dora index</code
                    >, which calls <code
                        class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-sm"
                        >scip-*</code
                    >
                    to generate a SCIP index of your codebase. SCIP is a language
                    server protocol for code navigation, it contains every symbol
                    definition, reference, and relationship in your project.
                </p>
                <p>
                    <code
                        class="text-blue-300 bg-zinc-950 px-2 py-1 rounded text-sm"
                        >dora</code
                    > parses the SCIP protobuf file and converts it into a SQLite
                    database with tables for files, symbols, dependencies, and references.
                    It does some light processing: extracting symbol kinds from documentation
                    strings, flagging local variables, and computing aggregate counts.
                </p>
            </div>
        </section>

        <!-- Use Cases -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-6">Use Cases</h2>
            <div class="space-y-4 text-zinc-400">
                <div class="flex items-start gap-3">
                    <span class="text-blue-400 mt-1 text-xl">→</span>
                    <div>
                        <strong class="text-zinc-200">Refactoring</strong>
                        <p class="text-sm">
                            Find all references to a symbol before renaming it.
                            Understand the impact of moving a file.
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-blue-400 mt-1 text-xl">→</span>
                    <div>
                        <strong class="text-zinc-200">Code Review</strong>
                        <p class="text-sm">
                            Detect new circular dependencies. Flag files with
                            high coupling or complexity.
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-blue-400 mt-1 text-xl">→</span>
                    <div>
                        <strong class="text-zinc-200">Onboarding</strong>
                        <p class="text-sm">
                            Explore the codebase structure. Find entry points
                            and understand dependencies.
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-blue-400 mt-1 text-xl">→</span>
                    <div>
                        <strong class="text-zinc-200"
                            >Dead Code Detection</strong
                        >
                        <p class="text-sm">
                            Find symbols with zero references. Identify unused
                            exports and leaf files.
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-blue-400 mt-1 text-xl">→</span>
                    <div>
                        <strong class="text-zinc-200"
                            >AI-Assisted Development</strong
                        >
                        <p class="text-sm">
                            Give AI agents the context they need to make
                            informed changes without reading every file.
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</Layout>
